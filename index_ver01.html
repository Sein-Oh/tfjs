<!DOCTYPE html>
<html>

<head>
    <title>TFJS</title>
</head>

<body>
    <img id='img1' src='./train/test1.png'>
    <img id='img2' src='./train/test2.png'>
    <img id='img3' src='./train/test3.png'>
    <img id='img4' src='./train/test4.png'>
    <img id='img5' src='./train/test5.png'>
    <img id='img6' src='./train/test6.png'>
    <img id='img7' src='./train/test7.png'>
    <img id='img8' src='./train/test8.png'>
    <img id='img9' src='./train/test9.png'>
    <img id='img10' src='./train/test10.png'>
</body>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.2"> </script>
<script>
    //const ys = tf.tensor2d([[0,1],[0,1],[0,1],[0,1],[0,1],[1,0],[1,0],[1,0],[1,0],[1,0]]);
    const ys = tf.oneHot(tf.tensor1d([1,1,1,1,1,0,0,0,0,0], 'int32'), 2);
    let xs, myFit, model;
    async function getData() {
        const imgEle = document.getElementsByTagName('img');
        for (let i = 0; i < imgEle.length; i++) {
            const tens = tf.browser.fromPixels(imgEle[i]);
            const tens4d = tens.expandDims();
            if (i == 0) {
                xs = tens4d;
            } else {
                xs = xs.concat(tens4d);
            }
        }
        console.log(xs.shape);
    }

    async function predict(){
        const test1 = await tf.browser.fromPixels(img10).expandDims();
        const pred = await model.predict(test1).data();
        console.log(pred);
    }

    async function run() {
        getData();
        model = tf.sequential();
        model.add(tf.layers.conv2d({
            inputShape: [28, 28, 3],
            kernelSize: 2,
            filters: 4,
            strides: 1,
            activation: 'relu',
            kernelInitializer: 'varianceScaling'
        }));
        model.add(tf.layers.conv2d({ kernelSize: 2, filters: 4, strides: 1, activation: 'relu', kernelInitializer: 'varianceScaling' }));
        model.add(tf.layers.flatten());
        model.add(tf.layers.dense({ units: 30, kernelInitializer: 'varianceScaling', activation: 'softmax' }));
        model.add(tf.layers.dense({ units: 2, activation: 'linear' }));
        model.compile({ optimizer: tf.train.sgd(0.02), loss: 'meanSquaredError' });
        model.summary();

        myFit = await model.fit(xs, ys, { epochs: 50 });
        console.log('done');
        predict();
    }
    run();
</script>

</html>
